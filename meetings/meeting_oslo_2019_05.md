# WG back-end, meeting memo
Mon 27.5.2019 9-16 EET (UTC+2), Oslo

## Participants:
Roope Tervo , lead architect, FMI<br>
Petri Vuorio, alert expert, FMI<br>
Håvard Futsæter, lead api development, MET Norway<br>
Helen Korsmo, system developer, MET Norway<br>
Tomas Karlsson, lead architect, SMHI<br>
Gjermund, Deputy head of forecasting division in Tromsø, MET Norway<br>

## Agenda
9:00 -  9:20 Introductions, round-a-table, agenda, goals<br>
9:20 -  10:20 Current situation with examples + discussion (20 minutes for each institute)<br>
10:20 - 10:30 Break<br>
10:30 - 11:30 Differences between each institute<br>
11:30 - 12:30 Lunch<br>
12:30 - 15:30 Creating common CAP Example<br>
15:30 - 16:00 Conclusion and next steps<br>

## Notes

### General

#### ToR
- next to be introduced to steering groups

#### Introduction
Round table introduction.

Non-goal: Agreement on how warnings are created and issued, e.g. content of messages. 

Non-goal 2: Waiting on meteoalarm to create services with the common CAP profile.

Goal today: Common CAP example for FMI, MET and SMHI for one type of warning forecast. Intention is to build on this example to create a common CAP profile for the open data alerting services of our three countries. Use this format to either suggest for Meteoalarm adoption, or to harmonize it with the profile Meteoalarm will use.

#### Current situation
##### MET-Norway
Cooperation with NVE(hydrology) and NRK (presentation). Special extensions in our profile to fit both issuing from MET and NVE, and with how NRK wants to do presenation. Also, agreements on how the standard elements should be used(informal agreements on semantics), based on presenation logic needs and issuing. 

NVE and MET produce separate alerting feeds.

Different CAP flavor sent to Meteoalarm, and different presentation to the national presentation web sites.

Color code on awareness_level.

##### SMHI
Dedicated CAP tool(KEPS) for producing warnings in CAP.

New tool, TOVE, that support all text based forecasts, with automated suggestions for text. Serializiation format separated from production.

"Pre" alert messages in CAP-ish? Custom xml format for listing available views of CAP messages. Stable url that includedes all current messages in one response, instead of RSS. Messages presentented in several languages.

Active messages rely on syncing the client with available messages in the web service.

Separate list of ares with polygons, referenced by id in CAP.

Color coded categories of messages in the presentation(e.g forest fire). Also color code on severity(or awareness level?)

Separate message format for risks(not alerts yet).

###### FMI
Separate distribution for commercial and open data service?

Currently handling next day and day 1 - 5 differently. This will change. Each warning will be start to finish, independent of day.

Autogenerates texts for all CAP messages. Meteorologist defines time period, probability, area and relevant forecast parameter. No manual overrride.

Separate product for writing text to be read on the radio. Autogenerated, but with possibility for editing.

Storing results as WOML(GML based in-house format). Store in PostGres in future?

Produce multiple output formats from WOML. CAP, CAP 1.2, GeoServer WFS from PostGres ( mobile apps use that interface).

Interactive map presentation of alerts.

Fat atom feed that includes all CAP messages in the feed.

Push alerts in SOAP to meteoalarm at the moment.

Also collaborates with hydrology institute in Finland. FMI publish the warnings for them.

##### Differences between institutes
###### alert
One alert message, specifying CAP OASIS standard with xml namespace.

###### identifier
Unique string, in time and space, for an alert message. A message is the same across different representation formats, if the contents of the core elements is the same.

Must not be used to convey any information, except the identity of the message.

Format: Does not matter to FMI, MET and SMHI.

###### sender
Format: WMO Organization ID (OID).

###### sent
The time the message was produced.

###### status
Standard CAP 1.2.

Recommendation: Always have a valid "Test" message.

###### msgType
Standard CAP 1.2

UPDATE and CANCEL events by the rules of Google  Public Alerts CAP-elements-Definitions.pdf

We ignore "Ack" and "Error" messages types.

###### source
Ignore this.

###### scope
Always Public

###### restriction
Ignore.

###### code
Identifies the message as following MetCoOP CAP Standard, versioned.

Format: Link to the versioned specification document.

###### note
Ignore.

###### references
Standard CAP 1.2

Clarification: UPDATE msgType must refer to all previous messages that it updates.

###### incidents
Optional, according to Standard CAP 1.2. 

Future potential: Could be used for common incident registry. In that case, the identifier should be a resolvable URI.

For now, if used, it will be specific to the sender issuing the message. 

###### info
Only a single info container pr. language. So, if multiple info containers, its exact same information translated into multiple languages.

###### language
Standard CAP 1.2

###### category
Standard CAP 1.2

###### event
Future controlled vocabulary in english, issued by OASIS/WMO: https://docs.google.com/spreadsheets/d/1n5hvh7S9jCqyhmr6acP0FBHq4a9O2MBlxg39J6_eUoQ/edit#gid=40743640

We will follow that vocabulary. Until then, each institute uses what its has today.

###### responseType
Standard CAP 1.2

Note: Use "AllClear" for cancelling with UPDATE msgTYpe.

###### urgency
Standard CAP 1.2

Different usage of the terms between countries may cause confusion, but a solution requires harmonizing how forecasting is done in each nation.

We will not use "Unknown"

###### severity
Different usage of the terms between countries may cause confusion, but a solution requires harmonizing how forecasting is done in each nation.

We will not use "Minor" to publish "No Warnings" messages.
We will not use "Unknown"

###### certainty
Standard CAP 1.2

Different usage of the terms between countries may cause confusion, but a solution requires harmonizing how forecasting is done in each nation.

We will not use "Unknown"

###### audience
Ignore

###### eventCode

###### effective
Not used

###### onset
When the alert starts.

Always include this. Often, it will be the same as sent.

###### expires
Its says something about the end time of the validity of this message.

The alert is valid until expired or cancelled. 

Its NOT denoting the time when the weather is getting better.

We should always have a meaningful expires value.

###### senderName
We use it. Official names in local language and english etc.

###### headline
Short summary of the entire message(140 characters). Some clients might ONLY display this value.

###### decription
Mandatory

Standard CAP 1.2

###### instruction
Optional.

###### web
Mandatory.

Link to more human readable information about this alert.

#### Next steps
Finish going through the standard. Area and parameters are important subjects.

Discuss the feed and filtering services.

Engage forecast divisions for coming to an agreement on forecasting specific content of the alert.

### Next meeting
Meet at SMHI 2.september 2019 (full day meeting).

## Topics to discuss at nexxt meeting
- Each institute checks internally with the work so far, and reports back to the group.
- Check if its possible to collaborate on library for consuming and/or producing CAP. Check languages, existing libraries, resources available in the near future. 
- Implemenetation roadmap.
